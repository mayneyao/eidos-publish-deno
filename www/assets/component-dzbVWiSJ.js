import{r as a,l as W,o as K,j as t,b as B,d as G,h as Y,x as Z,e as J,D as Q,C as L,$ as I,f as V,i as H,w as $,R as P,F as A,N as ee,k as te,K as E,m as re,n as ne,p as se,q as oe,s as ae,t as le,v as ie,P as ce,y as ue,z as de,A as fe}from"./index-CHFZAUhc.js";const F=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],T=F[Math.floor(Math.random()*F.length)],ge=a.createContext({clientID:0,color:T[1],isCollabActive:!1,name:T[0],yjsDocMap:new Map});function X(e,o){return a.useContext(ge)}function me(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var he=me(function(e){const o=new URLSearchParams;o.append("code",e);for(let n=1;n<arguments.length;n++)o.append("v",arguments[n]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${o} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)});function z(e){const o=e.transform();return o!==null?new Set([o]):new Set}function pe({initialEditor:e,children:o,initialNodes:n,initialTheme:v,skipCollabChecks:b}){const h=a.useRef(!1),j=a.useContext(W);j==null&&he(9);const[c,{getTheme:f}]=j,S=a.useMemo(()=>{const l=v||f()||void 0,w=K(j,l);if(l!==void 0&&(e._config.theme=l),e._parentEditor=c,n)for(let s of n){let x=null,r=null;if(typeof s!="function"){const y=s;s=y.replace,x=y.with,r=y.withKlass||null}const N=e._nodes.get(s.getType());e._nodes.set(s.getType(),{exportDOM:N?N.exportDOM:void 0,klass:s,replace:x,replaceWithKlass:r,transforms:z(s)})}else{const s=e._nodes=new Map(c._nodes);for(const[x,r]of s)e._nodes.set(x,{exportDOM:r.exportDOM,klass:r.klass,replace:r.replace,replaceWithKlass:r.replaceWithKlass,transforms:z(r.klass)})}return e._config.namespace=c._config.namespace,e._editable=c._editable,[e,w]},[]),{isCollabActive:m,yjsDocMap:M}=X(),u=b||h.current||M.has(e.getKey());return a.useEffect(()=>{u&&(h.current=!0)},[u]),a.useEffect(()=>c.registerEditableListener(l=>{e.setEditable(l)}),[e,c]),t.jsx(W.Provider,{value:S,children:!m||u?o:null})}const U=new Set;function be(e){if(!U.has(e))throw new Promise(o=>{const n=new Image;n.src=e,n.onload=()=>{U.add(e),o(null)}})}const xe=e=>{try{return new URL(e).host===window.location.host?e:Q.IMAGE_PROXY+"/?url="+e}catch{return e}};function ve({altText:e,className:o,imageRef:n,src:v,width:b,height:h,maxWidth:j,nodeKey:c,editor:f,isResizing:S,setIsResizing:m,showCaption:M,caption:u}){const l=xe(v);be(l);const w=a.useCallback((s,x)=>{if(S)return;s.preventDefault(),s.stopPropagation(),m(!0);const r=n.current;if(!r)return;const N=r.offsetWidth,y=s.clientX,R=r.naturalHeight/r.naturalWidth,D=p=>{p.preventDefault(),p.stopPropagation();const k=p.clientX-y,g=x==="right"?N+k:N-k,d=f.getRootElement(),i=(d==null?void 0:d.offsetWidth)||j,C=Math.min(Math.max(g,100),i),q=Math.round(C*R);f.update(()=>{const O=L(c);I(O)&&O.setWidthAndHeight(C,q)})},_=p=>{p.preventDefault(),p.stopPropagation(),document.removeEventListener("mousemove",D,!0),document.removeEventListener("mouseup",_,!0),m(!1)};document.addEventListener("mousemove",D,!0),document.addEventListener("mouseup",_,!0)},[f,j,c,m,S,n]);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"relative inline-block group",children:[t.jsx("img",{className:o??"",src:l,alt:e,ref:n,style:{height:h,width:b,display:"block"},draggable:"false"}),t.jsx("div",{role:"left-handle",className:"absolute left-[4px] top-1/2 -translate-y-1/2 w-2 h-12 rounded-lg cursor-ew-resize opacity-0 group-hover:opacity-100 transition-opacity duration-200",onMouseDown:s=>w(s,"left"),children:t.jsx("div",{className:"absolute inset-0 bg-black/70 hover:bg-black/60 border border-white rounded-full"})}),t.jsx("div",{role:"right-handle",className:"absolute right-[4px] top-1/2 -translate-y-1/2 w-2 h-12 rounded-lg cursor-ew-resize opacity-0 group-hover:opacity-100 transition-opacity duration-200",onMouseDown:s=>w(s,"right"),children:t.jsx("div",{className:"absolute inset-0 bg-black/70 hover:bg-black/60 border border-white rounded-full"})})]}),M&&t.jsx("div",{className:"image-caption-container",children:t.jsxs(pe,{initialEditor:u,children:[t.jsx(B,{}),t.jsx(G,{}),t.jsx(Y,{contentEditable:t.jsx(Z,{className:"ImageNode__contentEditable",style:{width:b}}),placeholder:t.jsx("div",{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:J})]})})]})}function je(e){const{nodeKey:o}=e,[n]=H(),v=b=>{n.update(()=>{const h=L(o);I(h)&&h.setSrc(b)})};return t.jsxs(ce,{children:[t.jsx(ue,{className:"w-full",children:t.jsx("div",{className:"flex h-[70px] w-full items-center justify-center bg-gray-200",children:t.jsx("div",{className:"text-center",children:t.jsx("div",{className:"text-sm text-gray-500",children:"Add an image"})})})}),t.jsx(de,{className:"w-auto p-0",children:t.jsx(fe,{onSelected:v,onRemove:()=>{},disableColor:!0,hideRemove:!0,onlyImage:!0,height:300})})]})}function ye({src:e,altText:o,nodeKey:n,width:v,height:b,maxWidth:h,resizable:j,showCaption:c,caption:f,captionsEnabled:S}){var k;const m=a.useRef(null),M=a.useRef(null),[u,l,w]=V(n),[s,x]=a.useState(!1);X();const[r]=H(),[N,y]=a.useState(null),R=a.useRef(null),D=a.useCallback(g=>{if(u&&$(P())){g.preventDefault();const i=L(n);I(i)&&i.remove(),l(!1)}return!1},[u,n,l]),_=a.useCallback(g=>{const d=P(),i=M.current;if(u&&$(d)&&d.getNodes().length===1){if(c)return A(null),g.preventDefault(),f.focus(),!0;if(i!==null&&i!==document.activeElement)return g.preventDefault(),i.focus(),!0}return!1},[f,u,c]),p=a.useCallback(g=>R.current===f||M.current===g.target?(A(null),r.update(()=>{l(!0);const d=r.getRootElement();d!==null&&d.focus()}),!0):!1,[f,r,l]);return a.useEffect(()=>{let g=!0;const d=ee(r.registerUpdateListener(({editorState:i})=>{g&&y(i.read(()=>P()))}),r.registerCommand(le,(i,C)=>(R.current=C,!1),E),r.registerCommand(ae,i=>{const C=i;return s?!0:C.target===m.current?(C.shiftKey?l(!u):(w(),l(!0)),!0):!1},E),r.registerCommand(oe,i=>i.target===m.current?(i.preventDefault(),!0):!1,E),r.registerCommand(se,D,E),r.registerCommand(ne,D,E),r.registerCommand(re,_,E),r.registerCommand(te,p,E));return()=>{g=!1,d()}},[w,r,s,u,n,D,_,p,l]),(k=m.current)==null||k.closest("li"),t.jsx(a.Suspense,{fallback:null,children:t.jsx(t.Fragment,{children:t.jsx("div",{className:"not-prose w-full relative",children:e.length==0?t.jsx(je,{nodeKey:n}):t.jsx("div",{className:ie("flex items-center justify-center"),children:t.jsx(ve,{className:"",src:e,altText:o,imageRef:m,width:v,height:b,maxWidth:h,nodeKey:n,editor:r,isResizing:s,setIsResizing:x,showCaption:!1,caption:f})})})})})}export{ye as default};
